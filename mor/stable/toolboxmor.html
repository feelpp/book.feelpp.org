<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ToolboxMor :: Feel++ Docs</title>
    <link rel="canonical" href="https://docs.feelpp.org/mor/stable/toolboxmor.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="pbdw.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<script>!function(l,p){if(l.protocol!==p&&l.host=="docs.antora.org"){l.protocol=p}else if(/\.gitlab\.io$/.test(l.host)){l.replace(p+"//docs.antora.org"+l.pathname.substr(l.pathname.indexOf("/",1))+l.search+l.hash)}}(location,"https:")</script>

<script src="../../_/js/vendor/tabs-block-extension.js"></script>
<script src="../../_/js/vendor/tabs-block-behavior.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },

  TeX: {
      Macros: {
      RR: "{\\mathbb R}",
      NN: "{\\mathbb N}",
      Nso: "{N_{\\mathrm{so}}}",
      Nma: "{N_{\\mathrm{ma}}}",
      Nno: "{N_{\\mathrm{no}}}",
      Ne: "{N_{\\mathrm{e}}}",
      Ilag: ["{\\mathcal{I}^{\\mathrm{lag}}_{#1}}",1],
      calTh: "{\\mathcal{T}_h}",
      Ck: ["{\\mathcal{C}^{#1}}",1],
      Pk: ["{\\mathcal{P}^{#1}}",1],
      Qk: ["{\\mathcal{Q}^{#1}}",1],
      Pch: ["{P^{#1}_{c,h}}",1],
      Pcho: ["{P^{#1}_{c,h,0}}",1],
      Qch: ["{Q^{#1}_{c,h}}",1],
      Ich: ["{\\mathcal{I}^{#1}_{c,h}#2}",2],
      poly: ["{\\mathbb{#1}}",1],
      nf: "{n_f}",
      ngeo: "{n_{\\mathrm{geo}}}",
      geo: "{\\mathrm{geo}}",
      card: ["{\\operatorname{card}(#1)}",1],
      dim: ["{\\operatorname{dim}(#1)}",1],
      opdim: "{\\operatorname{dim}}",
      card: ["{\\operatorname{card}(#1)}",1],
      poly: ["{\\mathbb{#1}",1],
      R: ["{\\mathbb{R}^{#1}}",1],
      set: ["{\\left\\{#1\\right\\}}",1],
      diam: "{\\operatorname{diam}}",
      jump: ["{[\\![ #1 ]\\!]}",1],
      Next: "{\\mathrm{n}}",
      essinf: "{\\operatorname{ess}\\, \\operatorname{inf}}",
      tr: "{\\operatorname{tr}}",
      Id: "{\\mathcal{I}}",
      disp: ["{\\mathbf{#1}}",1],
      stresst: ["{\\mathbf{\\sigma(#1)}}",1],
      deformt: ["{\\mathbf{\\varepsilon(#1)}}",1],
      domain: "{\\Omega}",
      prect: ["{\\left\\(#1\\right\\)}",1],
      ds: "",
      bold: ["{\\bf #1}",1],
      p: "{\\mathrm{p}}",
      q:"{\\mathbf{q}}",
      n:"{\\mathbf{n}}",
      T:"{\\mathcal{T}}",
      F:"{\\mathcal{F}}",
      P:"{\\mathcal{P}}",
      v:"{\\mathbf{v}}"
  },
  extensions: ["mhchem.js"] }
});
</script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML'>
</script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>-->

<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-65761593-1"></script>
<script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-65761593-1')</script>
<script>var uiRootPath = '../../_'</script>

<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5f34e90f94876f0012457ea1&product=sop' async='async'></script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar  navbar-expand-sm bg-dark navbar-dark">
    <div class="navbar-brand">
      <div class="navbar-item feelpp-logo">
        <a href="https://docs.feelpp.org"><img src="../../_/img/feelpp-logo.svg" alt="Feel++ logo"/></a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <form class="search">
            <i class="fa-solid fa-search"></i>
            <input type="text" placeholder="Search Feel++ Docs" class="query" id="search-query">
          </form>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Manuals</div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.feelpp.org/user/">User</a>
            <a class="navbar-item" href="https://docs.feelpp.org/dev/">Developer</a>
            <a class="navbar-item" href="https://docs.feelpp.org/toolbox/">Toolbox</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link" data-title="Support">
            <span class="icon"><img src="../../_/img/octicons-24.svg#view-comment-discussion"></span>
          </div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item has-icon" href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">
              <span class="icon"><img src="../../_/img/slack-icon.svg"></span>
              <span>Chat</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/orgs/feelpp/discussions" target="_blank" rel="noopener">
              <span class="icon"><img src="../../_/img/octicons-16.svg#view-discussion-closed"></span>
              <span>Discussions</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../../_/img/octicons-16.svg#view-mark-github"></span>
              <span>Source</span>
            </a>
            <a class="navbar-item has-icon" href="https://twitter.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../../_/img/octicons-16.svg#view-hash"></span>
              <span>Tweets</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp/book.feelpp.org/issues/new">
              <span class="icon"><img src="../../_/img/octicons-16.svg#view-bug"></span>
              <span>Issues</span>
            </a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable download-item">
          <div class="navbar-item"><div class="download-btn">Get Feel++</div></div>
          <div class="navbar-dropdown is-right">
              <a class="navbar-item" href="../../user/stable/install/index.html" target="_blank" rel="noopener">
                <span>Stable (0.110)</span>
              </a>
              <a class="navbar-item" href="../../user/latest/install/index.html" target="_blank" rel="noopener">
                <span>Latest</span>
              </a>
          </div>
        </div>
        <div class="navbar-item">
          <a class="navbar-brand"  href="https://www.cemosis.fr">
            <img class="cemosis-logo"  src="../../_/img/cemosis-logo.svg" alt="Cemosis logo"/>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<a href="#" class="menu-expand-toggle"></a>
<div class="nav-container" data-component="mor" data-version="0.110">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Model Order Reduction</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="toolboxmor.html">ToolboxMor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_creating_a_model_from_scratch">Creating a model from scratch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_creating_a_model_from_a_toolbox">Creating a model from a toolbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_configuration">Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="pbdw.html">PBDW</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pbdw.html#_sensors">Sensors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pbdw.html#_using_pbdw">Using PBDW</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html#_cases">Cases</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="opusheat/index.html">OpusHeat</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="thermalfin/index.html">ThermalFin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Model Order Reduction</span>
    <span class="version">0.110</span>
  </div>
  <ul class="components">
      <li class="component">
        <a class="title" href="../../user/stable/index.html">Feel++ User Manual</a>
          <ul class="versions">
              <li class="version">
                <a href="../../user/latest/index.html">latest</a>
              </li>
              <li class="version is-latest">
                <a href="../../user/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../user/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../dev/stable/index.html">Developer manual</a>
          <ul class="versions">
              <li class="version">
                <a href="../../dev/latest/index.html">latest</a>
              </li>
              <li class="version is-latest">
                <a href="../../dev/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../dev/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../data/stable/index.html">Data Manual</a>
          <ul class="versions">
              <li class="version">
                <a href="../../data/latest/index.html">latest</a>
              </li>
              <li class="version is-latest">
                <a href="../../data/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../data/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../math/index.html">Feel++ Mathematics</a>
          <ul class="versions">
              <li class="version is-latest">
                <a href="../../math/index.html">master</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../toolboxes/stable/index.html">Feel++ Toolboxes Manual</a>
          <ul class="versions">
              <li class="version">
                <a href="../../toolboxes/latest/index.html">latest</a>
              </li>
              <li class="version is-latest">
                <a href="../../toolboxes/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../toolboxes/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../cases/stable/index.html">Feel++ Toolbox Cases Guide</a>
          <ul class="versions">
              <li class="version">
                <a href="../../cases/latest/index.html">latest</a>
              </li>
              <li class="version is-latest">
                <a href="../../cases/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../cases/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../angiotk/stable/index.html">AngioTK User Manual</a>
          <ul class="versions">
              <li class="version is-latest">
                <a href="../../angiotk/stable/index.html">0.1</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../salome/stable/index.html">Feel++ and Salome</a>
          <ul class="versions">
              <li class="version is-latest">
                <a href="../../salome/stable/index.html">current</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../feelpp/stable/index.html">Feel++ Documentation</a>
          <ul class="versions">
              <li class="version is-latest">
                <a href="../../feelpp/stable/index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../../feelpp/0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../feelpp-tutorial-dev/index.html">Feel++ Programming Tutorial</a>
      </li>
      <li class="component">
        <a class="title" href="../../feelpp-project/index.html">Feel++ Project</a>
      </li>
      <li class="component is-current">
        <a class="title" href="index.html">Model Order Reduction</a>
          <ul class="versions">
              <li class="version">
                <a href="../latest/index.html">latest</a>
              </li>
              <li class="version is-current is-latest">
                <a href="index.html">0.110</a>
              </li>
              <li class="version">
                <a href="../0.109/index.html">0.109</a>
              </li>
          </ul>
      </li>
      <li class="component">
        <a class="title" href="../../contribute/index.html">Toolbox Contribution Guide</a>
          <ul class="versions">
              <li class="version is-latest">
                <a href="../../contribute/index.html">master</a>
              </li>
          </ul>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
    <a href="../../home/index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Model Order Reduction</a></li>
    <li><a href="toolboxmor.html">ToolboxMor</a></li>
  </ul>
</nav>

  <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.110</button>
  <div class="version-menu">
    <a class="version" href="../latest/toolboxmor.html">latest</a>
    <a class="version is-current" href="toolboxmor.html">0.110</a>
    <a class="version is-missing" href="../0.109/index.html">0.109</a>
  </div>
</div>

    <div class="edit-this-page"><a href="https://github.com/feelpp/book.feelpp.org/blob/v0.110/docs/mor/modules/ROOT/pages/toolboxmor.adoc">Edit this Page</a></div>
  
  <div class="page-downloads">
  <span class="label">Download as</span>
  <ul class="download-options">
    <li>
      <a onclick="print(this)" href="#" data-toggle="tooltip" data-placement="left" title="Print to PDF"
         class="pdf-download">
        <img class="pdf-file-icon icon" src="../../_/img/pdf.svg"/> .pdf
      </a>
    </li>
  </ul>
</div>
</div>

  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">ToolboxMor</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ToolboxMor is a class aiming to ease the use of the model order reduction framework of Feel++.
Usually, you would need to define a class which would handle the initialization of the model, its affine decomposition and possibly the use of the EIM methods.
ToolboxMor handles all the necessary methods and the user only needs to give two methods: one which will assemble the matrix for a given parameter, and one which will assemble the right hand side for a given parameter.</p>
</div>
<div class="paragraph">
<p>There is currently two main drawbacks, it does not work for non-linear problem and it does not work for problem where the function space is a product.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_model_from_scratch"><a class="anchor" href="#_creating_a_model_from_scratch"></a>1. Creating a model from scratch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, the class is templated by the type of the function space used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">using space_type = Pch_t&lt;mesh_type, 1&gt;;
using rb_model_type = ToolboxMor&lt;space_type&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of the constructor is the name used to store the database.
Then we need to set the function space used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">auto Xh = space_type::New(mesh);
auto model = std::make_shared&lt;rb_model_type&gt;("mymodel");
model-&gt;setFunctionSpace(Xh);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, we just need to set the assembly functions for the matrix and the right hand side, and initialize the model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">using deim_function_type = typename rb_model_type::deim_function_type;
using mdeim_function_type = typename rb_model_type::mdeim_function_type;

deim_function_type assembleDEIM = [&amp;Xh,&amp;u](parameter_type const&amp; mu) {
    auto l = form1(_test=Xh);
    l = integrate(_range=elements(support(Xh)), _expr=mu[0]*id(u) );
    return l.vectorPtr();
}
mdeim_function_type assembleDEIM = [&amp;Xh,&amp;u](parameter_type const&amp; mu) {
    auto m = form2(_trial=Xh, _test=Xh);
    m = integrate(_range=elements(support(Xh)), _expr=mu[1]*inner(id(u),idt(u)) );
    return m.matrixPtr();
}

model-&gt;setAssembleDEIM(assembleDEIM);
model-&gt;setAssembleMDEIM(assembleMDEIM);
model-&gt;initModel();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will compute the affine decomposition of the right hand side and the matrix by using the discrete version of EIM.
For the online phase, we need to assemble the matrix and the rhs on the reduced mesh produced by the discrete version of EIM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">auto XhDEIM = space_type::New(model-&gt;getDEIMReducedMesh());
auto uDEIM = XhDEIM-&gt;element();
deim_function_type assembleOnlineDEIM = [&amp;XhDEIM,&amp;uDEIM](parameter_type const&amp; mu) {
    auto l = form1(_test=XhDEIM);
    l = integrate(_range=elements(support(XhDEIM)), _expr=mu[0]*id(uDEIM) );
    return l.vectorPtr();
}
auto XhMDEIM = space_type::New(model-&gt;getMDEIMReducedMesh());
auto uMDEIM = XhMDEIM-&gt;element();
mdeim_function_type assembleOnlineMDEIM = [&amp;XhMDEIM,&amp;uMDEIM](parameter_type const&amp; mu) {
    auto m = form2(_trial=XhMDEIM, _test=XhMDEIM);
    m = integrate(_range=elements(support(XhMDEIM)), _expr=mu[1]*inner(id(uMDEIM),idt(uMDEIM)) );
    return m.matrixPtr();
}
model-&gt;setOnlineAssembleDEIM(assembleOnlineDEIM);
model-&gt;setOnlineAssembleMDEIM(assembleOnlineMDEIM);
model-&gt;postInitModel();
model-&gt;setInitialized(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that is done, the model is ready to compute the reduced basis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">using crb_model_type = CRBModel&lt;rb_model_type&gt;;
using crb_type = CRB&lt;crb_model_type&gt;;
crb_model_ptrtype crbModel = std::make_shared&lt;crb_model_type&gt;(model);
crb_ptrtype crb = crb_type::New("mymodel", crbModel, crb::stage::offline);
crb-&gt;offline();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first argument of the New method of CRB must match the argument given to the constructor of ToolboxMor.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_model_from_a_toolbox"><a class="anchor" href="#_creating_a_model_from_a_toolbox"></a>2. Creating a model from a toolbox</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_a_deimmormodel"><a class="anchor" href="#_using_a_deimmormodel"></a>2.1. Using a DeimMorModel</h3>
<div class="paragraph">
<p>It is possible to use a DeimMorModel to simplify considerably the setup of ToolboxMor when we want to use a Toolbox for the assembly.
Let&#8217;s say we have a toolbox:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">auto heatBox = heat_tb_type::New(_prefix="heat");
heatBox-&gt;init();</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the DeimMorModelToolbox class to let ToolboxMor do most of the steps presented in the previous section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">rb_model_ptrtype model = std::make_shared&lt;rb_model_type&gt;("mymodel");
auto heatBoxModel = DeimMorModelToolbox&lt;heat_tb_type&gt;::New(heatBox);
model-&gt;initToolbox(heatBoxModel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then, we can already launch the offline phase of CRB.</p>
</div>
</div>
<div class="sect2">
<h3 id="_without_deimmormodel"><a class="anchor" href="#_without_deimmormodel"></a>2.2. Without DeimMorModel</h3>
<div class="paragraph">
<p>If we don&#8217;t want to use DeimMorModel, we can still create ourself the assembly functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cpp hljs" data-lang="cpp">auto rhs = heatBox-&gt;algebraicFactory()-&gt;rhs()-&gt;clone();
auto mat = heatBox-&gt;algebraicFactory()-&gt;matrix();
deim_function_type assembleDEIM =
    [&amp;heatBox,&amp;rhs,&amp;mat](parameter_type const&amp; mu)
        {
            for( int i = 0; i &lt; mu.size(); ++i )
                heatBox-&gt;addParameterInModelProperties(mu.parameterName(i), mu(i));
            heatBox-&gt;updateParameterValues();
            rhs-&gt;zero();
            heatBox-&gt;algebraicFactory()-&gt;applyAssemblyLinear( heatBox-&gt;algebraicBlockVectorSolution()-&gt;vectorMonolithic(), mat, rhs, {"ignore-assembly.lhs"} );
            return rhs;
        };
mdeim_function_type assembleMDEIM =
    [&amp;heatBox,&amp;rhs,&amp;mat](parameter_type const&amp; mu)
        {
            for( int i = 0; i &lt; mu.size(); ++i )
                heatBox-&gt;addParameterInModelProperties(mu.parameterName(i), mu(i));
            heatBox-&gt;updateParameterValues();
            mat-&gt;zero();
            heatBox-&gt;algebraicFactory()-&gt;applyAssemblyLinear( heatBox-&gt;algebraicBlockVectorSolution()-&gt;vectorMonolithic(), mat, rhs, {"ignore-assembly.rhs"} );
            return mat;
        };</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>3. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration is made through some options in the config file and from a json file.<br>
The options are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">toolboxmor.filename</dt>
<dd>
<p>The path to the json file</p>
</dd>
<dt class="hdlist1">toolboxmor.trainset-deim-size</dt>
<dd>
<p>The size of the trainset if EIM for the right hand side</p>
</dd>
<dt class="hdlist1">toolboxmor.trainset-mdeim-size</dt>
<dd>
<p>The size of the trainset if EIM for the matrix</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The json handles the definition of the parameters and the outputs.</p>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a>3.1. Parameters</h3>
<div class="paragraph">
<p>The parameters should be in a section CRBParameters and each have a minimum and maximum value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"CRBParameters":
{
    "myparam1":
    {
        "min":1,
        "max":3.5
    },
    "myotherparam":
    {
        "min":-2e2,
        "max":4e2
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameters without min or max value are ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="_outputs"><a class="anchor" href="#_outputs"></a>3.2. Outputs</h3>
<div class="paragraph">
<p>The outputs should be in a section CRBOutputs and each have a type.
There is 4 types available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mean</p>
</li>
<li>
<p>integrate</p>
</li>
<li>
<p>sensor</p>
</li>
<li>
<p>point</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"CRBOutputs":
{
    "myfirstoutput":
    {
        "type":"mean",
        "markers":["mymarker1","mymarker2"],
        "expr":"crb_u:crb_u",
        "topodim":3
    },
    "integrateoutput":
    {
        "type":"integrate",
        "markers":"othermarker",
        "expr":"myparam1*crb_dn_u:myparam1:crb_dn_u",
        "topodim":2
    },
    "sensor1":
    {
        "type":"sensor",
        "coord":[0.5,0.1,1],
        "radius":0.01
    },
    "pointA":
    {
        "type":"point",
        "coord":[1,0.2,0.5]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> entry is mandatory for all outputs, then each entry presented here are mandatory for each type of output except for the <code>expr</code> entry.
By default, the <code>expr</code> entry is <code>crb_u:crb_u</code> which is the identity of the field of interest.<br>
The symbols availables in the expression are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the names of the parameters</p>
</li>
<li>
<p><code>crb_u</code>: the identity of the field</p>
</li>
<li>
<p><code>crb_grad_u_0</code>: the first component of the gradient of the field</p>
</li>
<li>
<p><code>crb_grad_u_1</code>: the second component of the gradient of the field</p>
</li>
<li>
<p><code>crb_grad_u_2</code>: the third component of the gradient of the field</p>
</li>
<li>
<p><code>crb_dn_u</code>: the normal derivative of the field</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Model Order Reduction</a></span>
  <span class="next"><a href="pbdw.html">PBDW</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="sharethis-inline-share-buttons"></div>
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.cemosis.fr" class="icon">
            <img src="../../_/img/logoCemosisTransparent.png" alt="Cemosis">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.cemosis.fr" target="_blank" rel="noopener">Projects Documentation</a></li>
          <li><a href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">Forums(Slack)</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.cemosis.fr" target="_blank" rel="noopener">Cemosis</a></li>
          <li><a href="https://www.cemosis.fr/news" target="_blank" rel="noopener">News</a></li>
          <li><a href="https://www.cemosis.fr/projects" target="_blank" rel="noopener">Projects</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.feelpp.org" target="_blank" rel="noopener">Feel++ Documentation</a></li>
          <li><a href="http://docs.feelpp.org/user/">Get Started</a></li>
          <li><a href="http://docs.feelpp.org/user//install/distributions/">Downloads</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/cemosis.fr" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/cemosis" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/cemosis" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Cemosis, Université de Strasbourg</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.cemosis.fr/terms-of-use">Terms of Use</a>
        <a href="https://www.cemosis.fr/privacy-policy">Privacy Policy</a>
        <a href="https://www.cemosis.fr/cookie-policy">Cookie Policy</a>
        <a href="https://www.cemosis.fr/support-policy">Support Policy</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>


<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>

<script async id="search-script" src="../../_/js/vendor/docsearch.js" data-app-id="03CF2L5SFL" data-api-key="53f606259c1ee7b82a42956e0c776c3d" data-index-name="feelpp" data-stylesheet="../../_/css/vendor/docsearch.css">
</script>

<script type="text/javascript">
function toggleFullScreen() {
   var doc = window.document;
   var docEl = doc.documentElement;

   var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
   var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

   if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
       requestFullScreen.call(docEl);
   }
   else {
       cancelFullScreen.call(doc);
   }
}
</script>
  </body>
</html>
