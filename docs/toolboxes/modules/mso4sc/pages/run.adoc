
= Running {feelpp} Applications in the Portal
:toc: left
:uri-msoportal-www: http://portal.mso4sc.eu

TIP: when running into some strange portal behavior, first try to `logout/login` from the portal before reporting an issue.


[[purchase]]
== Purchase a {feelpp} application

To purchase an application from the *Marketplace* you have to be registered and logged in as a *EndUser* at least.

The process is the following:

* connect to the link:{uri-msoportal-www}[*Marketplace*], in *Home* (top left Marketplace page) you will find all available apps (*All categories*).
* Click on *Add to Cart* to purchase the app you want.
* Click on *Shopping Cart* and *Checkout* to go on
** fill the required forms for *shipping address*
** provide a *shipping address* if not already defined
** provide a *billing address* if not already defined
** Finalize your order by clicking on *Checkout*

To use the app, you will have to wait that the owner/seller of the app validate
you order. To check the status of your order:

* go to *My Inventory*
* go to *Product Orders*

You shall be to see your products and their status in each product form.


[[data]]
== Benchmarks and Examples Catalogue

Go to http://docs.feelpp.org/examples/0.105/[Examples] or http://docs.feelpp.org/benchmarks/0.105/[Benchmarks] {feelpp} guides to discover what is available

[[running]]
== Running an {feelpp} application in *Experiments*

* Select *Create App Instance*
** define an **ID** (_the ID is used later by the experiment tool to identify the experiment_)
** select a registered app in the menu

At this point you should have a page with all the options that need to be filled before moving to *Deploy Instance*

image::Portal_HifiMagApp.png[ex: Main {feelpp} app]

The fields to fill may be grouped into categories:

* specs for running simulations
* HPC settings
* specs retrieving singularity images
* specs for singularity image

The *EndUser* shall only need to fill the fields related to the 1st and 2nd category.
The fields that are to be filled by *EndUser* are marked in *bold*.



.List of keys specs for running simulations
[options="header,footer"]
|===
| Key                           | Description                                 | Default                                                            | Notes
| **<toolbox>_case**                    | string that describe the location of the testcase                             | ``                       |
| *<toolbox slug name>_cli**                     | command line options                           |  "" |
|===

.List of keys to be defined for HPC settings
[options="header,footer"]
|===
| Key                        | Description              | Default          | Notes
| *slurm_n_tasks* | number of tasks to be used in parallel | 10 |  shall depends on batch system and selected partition
| *slurm_max_time* | maximum allowed time for run (minutes and seconds) | '00:30:00' |  shall depends on batch system and selected partition
|===



Once filled, click on *Create Instance*. The default parametrization should works right away.

This results in the execution on the selected HPC resource of the bootstrap script included in the app definition.

TIP: Any error will result in a message at the top of the page, bellow the menus.

The next step is to *Deploy Instance*:

* select the *ID*, you defined in the previous step, in the *App instance * menu
* click on *Deploy*, wait until the button in blue turns green

To *Run Instance*, the procedure is similar:

* select the *ID*, you defined in the previous step, in the *App instance* menu
* click on *RUN*

[TIP]
====
These step may take some minutes to be performed. A red button will indicates an error.
Check the message in the frame bellow the status button. To have more details about the actual error
is more tricky; we recommend to:

* make sure you have unchecked the cleanup option
* connect to the HPC resource
* move to the selected `base_dir/working_prefix<id>`
* check the logs

`base_dir`, `working_prefix` are filled within the portal *Experiments*.
The `<id>` is a random character generated by the deployment.

An other option is to run the app using the *orchestrator CLI*.
see https://github.com/MSO4SC/resources/blob/master/blueprint/feelpp/feelpp_test/README.adoc[this file] for details

====

You may cleanup the execution of the job *ID* by

* UnDeploy your Instance
** select the *ID*, you defined in the previous step, in the *App instance * menu
** click on *UnDeploy*

* Destroy your Instance
** select the *ID*, you defined in the previous step, in the *App instance * menu
** click on *Destroy*

[[post]]
== Setting up an Remote Desktop resource in *Visualization*

* Go to {uri-msoportal-visu-www}[*Visualization*]
* Select *Settings*
* Define a Remote Desktop resource

[source,java]
----
include::{examplesdir}/remotedesktop.txt[]
----

=== Running an Remote Desktop resource in *Visualization*

* Go to *Visualization*
* Click *Desktop Available*
** Select your *Infrastructure* in the sliding menu

[NOTE]: if no *Remote desktop* is defined, you will receive a warning message. Create a <<post, *Setting*>>, then go back to this step.

** Click on *Create*
** Click either on *Desktop* or *View Only*

it should start a web page within your browser.
In this page you should be able to:

* start a 'terminal' and check the output of your simulation
* start a post-processing GUI:
** either by loading {uri-paraview-www}[{paraview}]
** or using singularity {uri-ensight-www}[{ensight}] image
* to quit just click on `Menu/logout` (top left)

For more details on using {paraview} or {ensight} please check XXXX.

[NOTE]
====
The result are stored in `${LUSTRE}/feel/<workdir_prefix>_<date>_<id>` if
you have chosen to use the `<hpc_volumes>` bindmount option: `${LUSTRE}/feel:/feel`.

Check the output of the script in `<basedir>/<workdir_prefix>_<date>_<id>`
to see the exact name of this directory.
====
